<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<title>Transaction Log</title>
<link rel="stylesheet" data-href="/styles/transactions.css">
<script>
    (function() {
        const link = document.querySelector('link[data-href]');
        if (!link) return;
        const href = link.getAttribute('data-href');
        link.setAttribute('href', location.protocol === 'file:' ? href.replace(/^\//, '') : href);
    })();
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<script>
    (function() {
        if (location.protocol !== 'file:') return;
        const routeMap = {
            '/': 'barcode_receiver.html',
            '/add-product': 'add_product.html',
            '/item-list': 'item_list.html',
            '/transactions': 'transactions.html',
            '/reports': 'reports.html'
        };
        document.querySelectorAll('a[href^="/"]').forEach(a => {
            const href = a.getAttribute('href');
            if (!href) return;
            if (href.startsWith('/edit-product/')) {
                const barcode = href.split('/').pop();
                a.setAttribute('href', `edit_product.html?barcode=${encodeURIComponent(barcode)}`);
            } else if (href.startsWith('/item-history/')) {
                const barcode = href.split('/').pop();
                a.setAttribute('href', `item_history.html?barcode=${encodeURIComponent(barcode)}`);
            } else {
                const base = href.split('?')[0].replace(/\/$/, '');
                if (routeMap[base]) a.setAttribute('href', routeMap[base]);
            }
        });
    })();
</script>

<!-- route mapping / data-href handled at end of body -->

<body>
    <nav id="sidebar">
        <h2>Menu</h2>
        <ul>
            <li><a href="barcode_receiver.html">üìä Inventory</a></li>
            <li><a href="/add-product">‚ûï Add Product</a></li>
            <li><a href="/item-list">üìù Item List</a></li>
            <li><a href="/transactions" class="active">üìà Transactions</a></li>
            <li><a href="/reports">üìÑ Reports</a></li>
        </ul>
    </nav>

    <main id="main-content">
        <div class="container">
            <h1>Transaction History</h1>
            <div id="controls">
                <div id="search-area"> <label for="searchCategory">Search By:</label> <select id="searchCategory"> <option value="name">Item Name</option> <option value="date">Date</option> <option value="type">Type (Add/Cut)</option> </select> <input type="text" id="searchNameInput"
                        placeholder="Enter item name..."> <input type="date" id="searchDateInput" style="display: none;"> <input type="text" id="searchTypeInput" placeholder="Enter 'Add' or 'Cut'" style="display: none;">
                    <div id="suggestions"></div>
                </div> <button id="exportButton">Export to CSV</button> </div>
            <table id="transactionTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Item Name (Size)</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>New Stock</th>
                    </tr>
                </thead>
                <tbody id="transactionTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center;">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="container">
            <h2>Transaction Graph</h2>
            <div id="graphContainer"> <canvas id="transactionChart"></canvas> </div>
        </div>
    </main>

    <script type="module" data-src="/scripts/transactions.js"></script>
    <script>
        (function() {
            // set script src attributes
            const scripts = document.querySelectorAll('script[data-src]');
            scripts.forEach(s => {
                const d = s.getAttribute('data-src');
                if (!d) return;
                s.setAttribute('src', location.protocol === 'file:' ? d.replace(/^\//, '') : d);
            });

            // set anchor hrefs from data-href
            document.querySelectorAll('a[data-href]').forEach(a => {
                const data = a.getAttribute('data-href');
                if (!data) return;
                a.setAttribute('href', location.protocol === 'file:' ? data.replace(/^\//, '') : data);
            });

            // when under file://, rewrite server-style links to local filenames
            if (location.protocol !== 'file:') return;
            const routeMap = {
                '/': 'barcode_receiver.html',
                '/add-product': 'add_product.html',
                '/edit-product': 'edit_product.html',
                '/item-list': 'item_list.html',
                '/item-history': 'item_history.html',
                '/transactions': 'transactions.html',
                '/reports': 'reports.html'
            };
            document.querySelectorAll('a[href^="/"]').forEach(a => {
                const href = a.getAttribute('href');
                if (!href) return;
                if (href.startsWith('/edit-product/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `edit_product.html?barcode=${encodeURIComponent(barcode)}`);
                } else if (href.startsWith('/item-history/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `item_history.html?barcode=${encodeURIComponent(barcode)}`);
                } else {
                    const base = href.split('?')[0].replace(/\/$/, '');
                    if (routeMap[base]) a.setAttribute('href', routeMap[base]);
                }
            });
        })();
    </script>
</body>

</html>