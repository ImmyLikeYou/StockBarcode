<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="page_title_reports">Reports</title>
    <link rel="stylesheet" data-href="/styles/reports.css">
    <script>
        (function() {
            const link = document.querySelector('link[data-href]');
            if (!link) return;
            const href = link.getAttribute('data-href');
            link.setAttribute('href', location.protocol === 'file:' ? href.replace(/^\//, '') : href);
        })();
    </script>
</head>

<body>
    <nav id="sidebar">
        <div id="lang-switcher">
            <button id="lang-en">EN</button>
            <button id="lang-th">TH</button>
        </div>
        <h2 data-i18n-key="nav_menu">Menu</h2>
        <ul>
            <li><a href="barcode_receiver.html" data-i18n-key="nav_inventory">üìä Inventory</a></li>
            <li><a href="/add-product" data-i18n-key="nav_add_product">‚ûï Add Product</a></li>
            <li><a href="/item-list" data-i18n-key="nav_item_list">üìù Item List</a></li>
            <li><a href="/categories" data-i18n-key="nav_categories">üóÇÔ∏è Categories</a></li>
            <li><a href="/transactions" data-i18n-key="nav_transactions">üìà Transactions</a></li>
            <li><a href="/reports" class="active" data-i18n-key="nav_reports">üìÑ Reports</a></li>
        </ul>
    </nav>

    <main id="main-content">
        <div class="container">
            <h2 data-i18n-key="reports_inventory_summary_title">Inventory Value Summary</h2>
            <p data-i18n-key="reports_inventory_summary_desc">Current stock levels, cost per item, and total value of all items in inventory.</p>

            <div id="summary-controls">
                <div id="search-area">
                    <label for="summaryFilterCategory" data-i18n-key="reports_search_by">Filter By:</label>
                    <select id="summaryFilterCategory">
                        <option value="all" data-i18n-key="reports_search_all">All</option>
                        <option value="name" data-i18n-key="reports_search_name">Product Name</option>
                        <option value="size" data-i18n-key="reports_search_size">Size</option>
                        </select>
                    <input type="text" id="summarySearchInput" placeholder="Search..." data-i18n-key="reports_search_placeholder" data-i18n-placeholder="true">
                </div>
                <div id="button-area">
                    <button id="summaryClearButton" data-i18n-key="reports_clear_filter">Clear</button>
                    <button id="summaryExportButton" class="export-btn" data-i18n-key="reports_export_csv">Export to CSV</button>
                </div>
            </div>

            <table id="inventorySummaryTable">
                <thead>
                    <tr>
                        <th data-i18n-key="reports_table_category">Category</th>
                        <th data-i18n-key="reports_table_item_size">Item (Size)</th>
                        <th data-i18n-key="reports_table_current_stock">Current Stock</th>
                        <th data-i18n-key="reports_table_cost_ea">Cost (ea.)</th>
                        <th data-i18n-key="reports_table_total_value">Total Value</th>
                    </tr>
                </thead>
                <tbody id="inventorySummaryTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center;" data-i18n-key="reports_loading">Loading report...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="container">
            <h1 data-i18n-key="reports_title">Reports</h1>
            <h2 data-i18n-key="reports_most_active_title">Most Active Items</h2>
            <p data-i18n-key="reports_most_active_desc">Items ranked by the total number of transactions (Add, Cut, Adjust).</p>
            <table id="reportTable">
                <thead>
                    <tr>
                        <th data-i18n-key="reports_table_rank">Rank</th>
                        <th data-i18n-key="reports_table_name">Stock Barcode</th>
                        <th data-i18n-key="reports_table_barcode">Barcode</th>
                        <th data-i18n-key="reports_table_count">Transaction Count</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    <tr>
                        <td colspan="4" style="text-align: center;" data-i18n-key="reports_loading">Loading report...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script type="module" data-src="/scripts/reports.js"></script>
    <script>
        (function() {
            // set script src attributes
            const scripts = document.querySelectorAll('script[data-src]');
            scripts.forEach(s => {
                const d = s.getAttribute('data-src');
                if (!d) return;
                s.setAttribute('src', location.protocol === 'file:' ? d.replace(/^\//, '') : d);
            });

            // set anchor hrefs from data-href
            document.querySelectorAll('a[data-href]').forEach(a => {
                const data = a.getAttribute('data-href');
                if (!data) return;
                a.setAttribute('href', location.protocol === 'file:' ? data.replace(/^\//, '') : data);
            });

            // when under file://, rewrite server-style links to local filenames
            if (location.protocol !== 'file:') return;
            // --- UPDATED ROUTEMAP ---
            const routeMap = {
                '/': 'barcode_receiver.html',
                '/add-product': 'add_product.html',
                '/edit-product': 'edit_product.html',
                '/item-list': 'item_list.html',
                '/item-history': 'item_history.html',
                '/transactions': 'transactions.html',
                '/reports': 'reports.html',
                '/categories': 'categories.html'
            };
            document.querySelectorAll('a[href^="/"]').forEach(a => {
                const href = a.getAttribute('href');
                if (!href) return;
                if (href.startsWith('/edit-product/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `edit_product.html?barcode=${encodeURIComponent(barcode)}`);
                } else if (href.startsWith('/item-history/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `item_history.html?barcode=${encodeURIComponent(barcode)}`);
                } else {
                    const base = href.split('?')[0].replace(/\/$/, '');
                    if (routeMap[base]) a.setAttribute('href', routeMap[base]);
                }
            });
        })();
    </script>
</body>

</html>