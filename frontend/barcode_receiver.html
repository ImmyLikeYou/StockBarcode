<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="page_title_inventory">Barcode Inventory System</title>
    <link rel="stylesheet" data-href="/styles/receiver.css">
    <script>
        // Handle stylesheet paths for file:// and http(s)
        (function() {
            // Set stylesheet path
            document.querySelectorAll('link[data-href]').forEach(link => {
                const href = link.getAttribute('data-href');
                if (!href) return;
                link.setAttribute('href', location.protocol === 'file:' ? href.replace(/^\//, '') : href);
            });
        })();
    </script>
    <script type="module" data-src="/scripts/route_handler.js"></script>
</head>

<body>
    <nav id="sidebar">
        <div id="lang-switcher">
            <button id="lang-en">EN</button>
            <button id="lang-th">TH</button>
        </div>
        <h2 data-i18n-key="nav_menu">Menu</h2>
        <ul>
            <li><a href="barcode_receiver.html" class="active" data-i18n-key="nav_inventory">üìä Inventory</a></li>
            <li><a href="/add-product" data-i18n-key="nav_add_product">‚ûï Add Product</a></li>
            <li><a href="/item-list" data-i18n-key="nav_item_list">üìù Item List</a></li>
            <li><a href="/transactions" data-i18n-key="nav_transactions">üìà Transactions</a></li>
            <li><a href="/reports" data-i18n-key="nav_reports">üìÑ Reports</a></li>
        </ul>
    </nav>

    <main id="main-content">
        <div id="top-container">
            <div id="scanner-container">
                <button id="clearQuickLogButton" data-i18n-key="inventory_clear_log_button">Clear</button>
                <h1 data-i18n-key="inventory_title">Barcode Scanner</h1>
                <p data-i18n-key="inventory_subtitle">Select a Mode/Amount/Size and scan your item.</p>
                <form id="scanForm">
                    <input type="text" id="barcodeInput" placeholder="Waiting for scan..." data-i18n-key="inventory_placeholder" data-i18n-placeholder="true" autofocus>
                </form>
                <h3 data-i18n-key="inventory_quick_log">Quick Log:</h3>
                <ul id="scanLog"></ul>
            </div>
            <div id="transaction-controls">
                <h3 data-i18n-key="inventory_mode_title">Transaction Mode:</h3>
                <div>
                    <input type="radio" id="modeCut" name="transactionMode" value="cut" checked> <label for="modeCut" data-i18n-key="inventory_mode_cut">Cut Stock</label><br>
                    <input type="radio" id="modeAdd" name="transactionMode" value="add"> <label for="modeAdd" data-i18n-key="inventory_mode_add">Add Stock</label><br>
                    <input type="radio" id="modeAdjust" name="transactionMode" value="adjust"> <label for="modeAdjust" data-i18n-key="inventory_mode_adjust">Adjust Stock</label>
                </div>
                <h3 data-i18n-key="inventory_size_title">Size:</h3>
                <div>
                    <input type="radio" id="sizeS" name="transactionSize" value="S" checked> <label for="sizeS">S</label>
                    <input type="radio" id="sizeM" name="transactionSize" value="M"> <label for="sizeM">M</label>
                    <input type="radio" id="sizeL" name="transactionSize" value="L"> <label for="sizeL">L</label>
                    <input type="radio" id="sizeXL" name="transactionSize" value="XL"> <label for="sizeXL">XL</label> <br>
                    <input type="radio" id="sizeOne" name="transactionSize" value="ONE_SIZE"> <label for="sizeOne" data-i18n-key="inventory_size_one_size">One Size</label>
                </div>
                <h3 data-i18n-key="inventory_amount_title">Transaction Amount:</h3>
                <div> <input type="number" id="transactionAmountInput" value="1" min="1" step="1"> </div>
            </div>
        </div>
        <div id="bottom-container">
            <div id="inventory-container">
                <h2 data-i18n-key="inventory_current_stock">Current Stock</h2>
                <ul id="inventory-display"></ul>
            </div>
            <div id="sell-log-container">
                <h2 data-i18n-key="inventory_transaction_log">Transaction Log</h2>
                <div id="log-controls">
                    <div>
                        <label for="dateFilter" data-i18n-key="inventory_filter_date">Filter by Date:</label>
                        <input type="date" id="dateFilter">
                        <button id="filterButton" data-i18n-key="inventory_filter_button">Filter</button>
                        <button id="showAllButton" data-i18n-key="inventory_show_all_button">Show All</button>
                    </div>
                    <button id="clearLogButton" data-i18n-key="inventory_clear_log_button_main">Clear Log</button>
                </div>
                <ul id="sellLog"></ul>
            </div>
        </div>
    </main>
    <div id="deleteConfirmationModal" class="modal-overlay">
        <div class="modal-content">
            <h3 data-i18n-key="modal_delete_title">Confirm Deletion</h3>
            <p>
                <span data-i18n-key="modal_delete_text_pre">Are you sure you want to permanently delete</span>
                <strong id="itemToDeleteName">this item</strong>
                <span data-i18n-key="modal_delete_text_post">?</span>
            </p>
            <div class="modal-buttons">
                <button id="cancelDeleteBtn" data-i18n-key="modal_delete_cancel">Cancel</button>
                <button id="confirmDeleteBtn" data-i18n-key="modal_delete_confirm">Confirm Delete</button>
            </div>
        </div>
    </div>
    <div id="toastNotification" class="toast"> <span id="toastMessage"></span> </div>

    <script type="module" data-src="/scripts/receiver.js"></script>
    <script>
        (function() {
            // set script src attributes
            const scripts = document.querySelectorAll('script[data-src]');
            scripts.forEach(s => {
                const d = s.getAttribute('data-src');
                if (!d) return;
                s.setAttribute('src', location.protocol === 'file:' ? d.replace(/^\//, '') : d);
            });

            // set anchor hrefs from data-href
            document.querySelectorAll('a[data-href]').forEach(a => {
                const data = a.getAttribute('data-href');
                if (!data) return;
                a.setAttribute('href', location.protocol === 'file:' ? data.replace(/^\//, '') : data);
            });

            // when under file://, rewrite server-style links to local filenames
            if (location.protocol !== 'file:') return;
            const routeMap = {
                '/': 'barcode_receiver.html',
                '/add-product': 'add_product.html',
                '/edit-product': 'edit_product.html',
                '/item-list': 'item_list.html',
                '/item-history': 'item_history.html',
                '/transactions': 'transactions.html',
                '/reports': 'reports.html'
            };
            document.querySelectorAll('a[href^="/"]').forEach(a => {
                const href = a.getAttribute('href');
                if (!href) return;
                if (href.startsWith('/edit-product/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `edit_product.html?barcode=${encodeURIComponent(barcode)}`);
                } else if (href.startsWith('/item-history/')) {
                    const barcode = href.split('/').pop();
                    a.setAttribute('href', `item_history.html?barcode=${encodeURIComponent(barcode)}`);
                } else {
                    const base = href.split('?')[0].replace(/\/$/, '');
                    if (routeMap[base]) a.setAttribute('href', routeMap[base]);
                }
            });
        })();
    </script>
</body>

</html>